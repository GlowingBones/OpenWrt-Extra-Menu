OpenWrt LuCI 3rd Party Menu - Local Install Instructions
======================================================

This adds a top level "3rd Party" menu to LuCI with two entries:
- Transmission
- PGP Tools

Transmission points to the Transmission web UI on port 9091.
PGP Tools points to your browserPGP static site under /pgp.

Files
-----
You have these files from this package:
- thirdparty.lua

Where it goes on OpenWrt
------------------------
Copy thirdparty.lua to:
  /usr/lib/lua/luci/controller/thirdparty.lua

Commands to run on OpenWrt
--------------------------
1. Copy the file (example using scp from your PC):
   scp thirdparty.lua root@<router-ip>:/usr/lib/lua/luci/controller/

2. On the router, clear LuCI cache and restart services:
   rm -f /tmp/luci-indexcache
   rm -rf /tmp/luci-modulecache
   /etc/init.d/rpcd restart
   /etc/init.d/uhttpd restart

3. Log into LuCI in your browser.
   You should now see a top level menu tab:
     3rd Party

   Under it you should see:
     Transmission
     PGP Tools

4. Clicking the entries:

   3rd Party -> Transmission
     goes to:
       http://<router-ip>:9091/transmission/web/

   3rd Party -> PGP Tools
     goes to:
       http://<router-ip>/pgp/

Transmission requirements
-------------------------
On the router, Transmission must be installed, running, and have its web UI enabled on port 9091.

Typical packages on OpenWrt:
  opkg update
  opkg install transmission-daemon-openssl transmission-web luci-app-transmission
  /etc/init.d/transmission enable
  /etc/init.d/transmission start

You should be able to open:
  http://<router-ip>:9091/transmission/web/
directly in a browser before using the menu shortcut.

PGP Tools requirements
----------------------
You must already have the browserPGP static files installed under:
  /www/pgp

You should be able to open:
  http://<router-ip>/pgp/
directly in a browser before using the menu shortcut.

Adding more items later
-----------------------
If you want to add more items under 3rd Party, edit:
  /usr/lib/lua/luci/controller/thirdparty.lua

Example pattern to add a new entry:

1. In function index(), add an entry line, for example for Zabbix:

   entry({"admin", "thirdparty", "zabbix"}, call("action_zabbix"), _("Zabbix"), 30)

2. Add a matching function, for example:

   function action_zabbix()
       local http = require "luci.http"
       local host = http.getenv("HTTP_HOST") or ""
       host = host:gsub(":%d+$", "")

       -- redirect to Zabbix on port 8080
       http.redirect("http://" .. host .. ":8080/")
   end

3. After editing thirdparty.lua, run again:
   rm -f /tmp/luci-indexcache
   rm -rf /tmp/luci-modulecache
   /etc/init.d/rpcd restart
   /etc/init.d/uhttpd restart

Uninstall
---------
To remove the 3rd Party menu entirely:
  rm -f /usr/lib/lua/luci/controller/thirdparty.lua
  rm -f /tmp/luci-indexcache
  rm -rf /tmp/luci-modulecache
  /etc/init.d/rpcd restart
  /etc/init.d/uhttpd restart
